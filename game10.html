<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory Challenge</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
          .back-btn{
  position:fixed;
  top:15px;
  left:15px;
  z-index:9999;
  text-decoration:none;
  font-size:26px;
  color:white;
  background:rgba(0,0,0,0.6);
  padding:8px 14px;
  border-radius:50%;
  border:2px solid white;
}

.back-btn:active{
  background:white;
  color:black;
}
    body {
      box-sizing: border-box;
    }
    
    * {
      box-sizing: border-box;
    }

    @keyframes flip {
      0% { transform: rotateY(0deg); }
      50% { transform: rotateY(90deg); }
      100% { transform: rotateY(0deg); }
    }

    @keyframes match {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    .card-flip {
      animation: flip 0.5s ease-in-out;
    }

    .card-match {
      animation: match 0.3s ease-in-out;
    }

    .card-shake {
      animation: shake 0.1s ease-in-out;
    }

    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Smooth transition for hiding the menu */
    .fade-out {
      animation: fadeOut 0.5s ease-in-out forwards;
    }

    @keyframes fadeOut {
      from { opacity: 1; visibility: visible; }
      to { opacity: 0; visibility: hidden; }
    }
  </style>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full w-full m-0 p-0 overflow-auto bg-gray-900"><a href="index.html" class="back-btn">‚Üê</a>

  <div id="mainMenu" class="fixed inset-0 z-50 flex items-center justify-center bg-center bg-cover bg-no-repeat" style="background-image: url('bg10.jpg');">
    <div class="absolute inset-0 bg-black bg-opacity-0 backdrop-blur-[2px]"></div>
    
    <button id="startGameBtn" class="relative z-1 translate-y-4 px-1 py-1 text-xl font-bold text-white transition-all transform rounded-2xl bg-gradient-to-r from-indigo-600 to-purple-600 hover:scale-110 shadow-[0_0_30px_rgba(102,126,234,0.8)] border-2 border-white/20 hover:border-white/60 focus:outline-none" style="font-family: 'Space Mono', 'Courier New', monospace;">
      ‚ñ∂ PLAY NOW
    </button>
  </div>

  <div id="app" class="hidden h-full w-full flex-col" style="font-family: 'Space Mono', 'Courier New', monospace; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
   
   <header class="text-white p-4 text-center">
    <h1 id="gameTitle" class="text-4xl font-bold mb-1" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">Memory Challenge</h1>
    <p id="instructionsText" class="text-lg opacity-90">Match all pairs to win!</p>
   </header>
   
   <div class="flex justify-center gap-3 px-6 mb-3">
    <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-md px-3 py-1 text-white">
     <div class="text-xs opacity-80">Moves</div>
     <div id="moves" class="text-lg font-bold">0</div>
    </div>
    <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-md px-3 py-1 text-white">
     <div class="text-xs opacity-80">Time</div>
     <div id="timer" class="text-lg font-bold">0:00</div>
    </div>
    <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-md px-3 py-1 text-white">
     <div class="text-xs opacity-80">Best</div>
     <div id="bestScore" class="text-lg font-bold">--</div>
    </div>
   </div>
   
   <div class="px-6 mb-3">
    <div class="flex justify-center gap-2 mb-2">
     <button id="easyBtn" class="px-3 py-1.5 rounded-lg text-xs font-bold text-white transition-all bg-white bg-opacity-30 hover:bg-opacity-40"> üå∏ Nature Park (12) </button> 
     <button id="mediumBtn" class="px-3 py-1.5 rounded-lg text-xs font-bold text-white transition-all bg-white bg-opacity-30 hover:bg-opacity-40"> üê† Ocean World (20) </button> 
     <button id="hardBtn" class="px-3 py-1.5 rounded-lg text-xs font-bold text-white transition-all bg-white bg-opacity-50 hover:bg-opacity-60"> üöÄ Space Galaxy (30) </button>
    </div>
    <div class="flex justify-center gap-2">
     <button id="foodBtn" class="px-3 py-1.5 rounded-lg text-xs font-bold text-white transition-all bg-white bg-opacity-30 hover:bg-opacity-40"> üçï Food Feast (16) </button> 
     <button id="sportsBtn" class="px-3 py-1.5 rounded-lg text-xs font-bold text-white transition-all bg-white bg-opacity-30 hover:bg-opacity-40"> ‚öΩ Sports Arena (24) </button> 
     <button id="musicBtn" class="px-3 py-1.5 rounded-lg text-xs font-bold text-white transition-all bg-white bg-opacity-30 hover:bg-opacity-40"> üéµ Music Studio (18) </button>
    </div>
   </div>
   
   <main class="flex-1 flex items-start justify-center px-20 pb-20 pt-2 overflow-auto">
    <div id="gameBoard" class="grid gap-3 mx-auto" style="justify-items: center; place-content: center;"></div>
   </main>
   
   <div id="victoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-6 z-50">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full text-center fade-in">
     <div class="text-6xl mb-4">üéâ</div>
     <h2 id="winMessage" class="text-4xl font-bold mb-4" style="color: #667eea;">Congrats!</h2>
     <p class="text-xl mb-2">You completed the game!</p>
     <p class="text-lg text-gray-600 mb-6"><span id="finalMoves"></span> moves in <span id="finalTime"></span></p>
     <button id="playAgainBtn" class="px-8 py-4 rounded-lg font-bold text-white transition-all text-xl" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"> Play Again </button>
    </div>
   </div>
  </div>

  <script>
    const defaultConfig = {
      game_title: "Memory Challenge",
      instructions_text: "Match all pairs to win!",
      win_message: "Congratulations!",
      background_color: "#667eea",
      card_back_color: "#ffffff",
      card_front_color: "#f0f0f0",
      text_color: "#ffffff",
      accent_color: "#764ba2"
    };

    let config = { ...defaultConfig };

    const themes = {
      easy: { name: 'Nature Park', symbols: ['üå∏', 'üå∫', 'üåª', 'üå∑', 'üåπ', 'ü¶ã', 'üêù', 'üêû', 'ü¶ú', 'üê¢', 'üêøÔ∏è', 'ü¶î', 'üçÑ', 'üåø', 'üçÄ'], bgColor: '#4ade80', accentColor: '#16a34a', numPairs: 8 },
      medium: { name: 'Ocean World', symbols: ['üê†', 'üêü', 'üê°', 'ü¶à', 'üêô', 'ü¶ë', 'ü¶û', 'ü¶Ä', 'üêö', 'ü¶ê', 'üê¨', 'üê≥', 'ü¶≠', 'ü™º', '‚≠ê'], bgColor: '#3b82f6', accentColor: '#1e40af', numPairs: 10 },
      hard: { name: 'Space Galaxy', symbols: ['üåç', 'üåé', 'üåè', 'ü™ê', 'üåô', '‚≠ê', '‚ú®', '‚òÑÔ∏è', 'üåü', 'üí´', 'üöÄ', 'üõ∏', 'üëΩ', 'üåå', 'üî≠'], bgColor: '#8b5cf6', accentColor: '#6d28d9', numPairs: 12 },
      food: { name: 'Food Feast', symbols: ['üçï', 'üçî', 'üçü', 'üå≠', 'üçø', 'üßÅ', 'üç¶', 'üç©', 'üç™', 'üéÇ', 'üç∞', 'ü•ê', 'ü•®', 'üßá', 'ü•û'], bgColor: '#f59e0b', accentColor: '#d97706', numPairs: 10 },
      sports: { name: 'Sports Arena', symbols: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'üéæ', 'üèê', 'üèâ', 'üé±', 'üèì', 'üè∏', 'ü•ä', 'ü•ã', '‚õ≥', 'üèπ', 'üéØ'], bgColor: '#ef4444', accentColor: '#dc2626', numPairs: 12 },
      music: { name: 'Music Studio', symbols: ['üéµ', 'üé∂', 'üé∏', 'üéπ', 'üé∫', 'üé∑', 'ü•Å', 'üéª', 'ü™ï', 'üé§', 'üéß', 'üéº', 'üé¨', 'üé™', 'üé≠'], bgColor: '#ec4899', accentColor: '#db2777', numPairs: 15 }
    };
    
    let cards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    let moves = 0;
    let timerInterval = null;
    let startTime = null;
    let currentDifficulty = 'hard';
    let isProcessing = false;

    // --- MAIN MENU LOGIC ---
    document.getElementById('startGameBtn').addEventListener('click', () => {
      const menu = document.getElementById('mainMenu');
      const app = document.getElementById('app');
      
      // Fade out menu and show game
      menu.classList.add('fade-out');
      setTimeout(() => {
        menu.style.display = 'none';
        app.classList.remove('hidden');
        app.classList.add('flex');
        initGame('hard'); // Start the actual game once menu is gone
      }, 500); // Matches the CSS animation duration
    });
    // -----------------------

    function initGame(difficulty = 'hard') {
      currentDifficulty = difficulty;
      const theme = themes[difficulty];
      const numPairs = theme.numPairs;
      
      clearInterval(timerInterval);
      startTime = null;
      moves = 0;
      matchedPairs = 0;
      flippedCards = [];
      isProcessing = false;
      
      document.getElementById('moves').textContent = '0';
      document.getElementById('timer').textContent = '0:00';
      document.getElementById('victoryModal').classList.add('hidden');
      
      // Update theme colors and title
      config.background_color = theme.bgColor;
      config.accent_color = theme.accentColor;
      document.getElementById('app').style.background = `linear-gradient(135deg, ${theme.bgColor} 0%, ${theme.accentColor} 100%)`;
      document.getElementById('instructionsText').textContent = `${theme.name} - Match all pairs to win!`;
      
      const selectedSymbols = theme.symbols.slice(0, numPairs);
      cards = [...selectedSymbols, ...selectedSymbols]
        .sort(() => Math.random() - 0.5)
        .map((symbol, index) => ({
          id: index,
          symbol,
          isFlipped: false,
          isMatched: false
        }));
      
      renderBoard();
      updateDifficultyButtons();
      loadBestScore();
    }

    function renderBoard() {
      const board = document.getElementById('gameBoard');
      const theme = themes[currentDifficulty];
      const totalCards = theme.numPairs * 2;
      
      let cols = 4;
      if (totalCards === 16) cols = 4;
      else if (totalCards === 18) cols = 6;
      else if (totalCards === 20) cols = 5;
      else if (totalCards === 24) cols = 6;
      else if (totalCards === 30) cols = 6;
      else if (totalCards === 12) cols = 4;
      
      board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
      board.innerHTML = '';
      
      const isLargeCardMode = ['easy', 'medium', 'food'].includes(currentDifficulty);
      
      cards.forEach(card => {
        const cardEl = document.createElement('button');
        cardEl.className = 'aspect-square rounded-xl font-bold transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-white focus:ring-opacity-50';
        cardEl.style.background = card.isMatched ? config.accent_color || defaultConfig.accent_color : (card.isFlipped ? (config.card_front_color || defaultConfig.card_front_color) : (config.card_back_color || defaultConfig.card_back_color));
        cardEl.style.color = card.isFlipped || card.isMatched ? '#333' : 'transparent';
        cardEl.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
        cardEl.style.width = '101%';
        
        cardEl.style.maxWidth = isLargeCardMode ? '150px' : '180px';
        cardEl.style.fontSize = isLargeCardMode ? '2rem' : '2rem'; 

        cardEl.textContent = card.isFlipped || card.isMatched ? card.symbol : '‚ùì';
        cardEl.disabled = card.isMatched || isProcessing;
        cardEl.onclick = () => flipCard(card.id);
        board.appendChild(cardEl);
      });
    }

    function flipCard(cardId) {
      if (isProcessing || flippedCards.length >= 2) return;
      
      const card = cards.find(c => c.id === cardId);
      if (card.isFlipped || card.isMatched) return;
      
      if (!startTime) {
        startTime = Date.now();
        startTimer();
      }
      
      card.isFlipped = true;
      flippedCards.push(card);
      
      const cardEl = document.getElementById('gameBoard').children[cardId];
      cardEl.classList.add('card-flip');
      
      renderBoard();
      
      if (flippedCards.length === 2) {
        moves++;
        document.getElementById('moves').textContent = moves;
        isProcessing = true;
        setTimeout(checkMatch, 600);
      }
    }

    function checkMatch() {
      const [card1, card2] = flippedCards;
      const board = document.getElementById('gameBoard');
      
      if (card1.symbol === card2.symbol) {
        card1.isMatched = true;
        card2.isMatched = true;
        matchedPairs++;
        
        board.children[card1.id].classList.add('card-match');
        board.children[card2.id].classList.add('card-match');
        
        if (matchedPairs === cards.length / 2) {
          setTimeout(showVictory, 500);
        }
        
        flippedCards = [];
        isProcessing = false;
        renderBoard();
      } else {
        board.children[card1.id].classList.add('card-shake');
        board.children[card2.id].classList.add('card-shake');
        
        setTimeout(() => {
          card1.isFlipped = false;
          card2.isFlipped = false;
          flippedCards = [];
          isProcessing = false;
          renderBoard();
        },300);
      }
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        document.getElementById('timer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      }, 1000);
    }

    function showVictory() {
      clearInterval(timerInterval);
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      
      document.getElementById('finalMoves').textContent = moves;
      document.getElementById('finalTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      document.getElementById('victoryModal').classList.remove('hidden');
      
      saveBestScore(moves);
    }

    function saveBestScore(score) {
      const key = `memoryBest_${currentDifficulty}`;
      const current = localStorage.getItem(key);
      if (!current || score < parseInt(current)) {
        localStorage.setItem(key, score.toString());
        loadBestScore();
      }
    }

    function loadBestScore() {
      const key = `memoryBest_${currentDifficulty}`;
      const best = localStorage.getItem(key);
      document.getElementById('bestScore').textContent = best || '--';
    }

    function updateDifficultyButtons() {
      const buttons = { easy: document.getElementById('easyBtn'), medium: document.getElementById('mediumBtn'), hard: document.getElementById('hardBtn'), food: document.getElementById('foodBtn'), sports: document.getElementById('sportsBtn'), music: document.getElementById('musicBtn') };
      
      Object.keys(buttons).forEach(key => {
        buttons[key].style.background = (key === currentDifficulty) ? 'rgba(255, 255, 255, 0.5)' : 'rgba(255, 255, 255, 0.3)';
      });
    }

    document.getElementById('easyBtn').onclick = () => initGame('easy');
    document.getElementById('mediumBtn').onclick = () => initGame('medium');
    document.getElementById('hardBtn').onclick = () => initGame('hard');
    document.getElementById('foodBtn').onclick = () => initGame('food');
    document.getElementById('sportsBtn').onclick = () => initGame('sports');
    document.getElementById('musicBtn').onclick = () => initGame('music');
    document.getElementById('playAgainBtn').onclick = () => initGame(currentDifficulty);

  </script>
 </body>
</html>
