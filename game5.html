<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floppy Bird</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
/* ===== RESET ===== */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  background: #fff;
  font-family: 'Press Start 2P', cursive;
  text-align: center;
  user-select: none;
}

/* ===== BACK BUTTON ===== */
.back-btn {
  position: fixed;
  top: 12px;
  left: 12px;
  z-index: 999;
  font-size: 22px;
  text-decoration: none;
  color: white;
  background: rgba(0,0,0,0.7);
  padding: 10px 14px;
  border-radius: 50%;
  border: 2px solid white;
}

.back-btn:active {
  background: white;
  color: black;
}

/* ===== HEADER ===== */
header {
  max-width: 431px;
  margin: 0 auto;
}

h1 {
  margin: 0;
  padding: 18px 0;
  font-size: 34px;
  background: url("https://i.ibb.co/Q9yv5Jk/flappy-bird-set.png") 0px 340px;
}

/* ===== SCORE BAR ===== */
.score-container {
  display: flex;
  justify-content: space-between;
  background: #5EE270;
  padding: 10px 14px;
  font-size: 13px;
}

/* ===== CANVAS ===== */
canvas {
  display: block;
  margin: 0 auto;
  width: 100vw;
  max-width: 431px;
  max-height: 527px;  
}
</style>
</head>

<body>

<a href="index.html" class="back-btn">‚Üê</a>

<header>
  <h1>Floppy Bird</h1>
  <div class="score-container">
    <div id="bestScore">Best : 0</div>
    <div id="currentScore">Current : 0</div>
  </div>
</header>

<canvas id="canvas" width="431" height="768"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;
ctx.webkitImageSmoothingEnabled = false;
ctx.mozImageSmoothingEnabled = false;
const img = new Image();
img.src = "https://i.ibb.co/Q9yv5Jk/flappy-bird-set.png";

/* ===== GAME VARIABLES ===== */
let gamePlaying = false;
const gravity = 0.5;
const speed = 6.2;
const jump = -11.5;
const size = [51, 36];
const pipeWidth = 78;
const pipeGap = 270;
const cTenth = canvas.width / 10;

let index = 0;
let bestScore = 0;
let currentScore = 0;
let flight = jump;
let flyHeight = canvas.height / 2;
let pipes = [];

/* ===== PIPE LOCATION ===== */
const pipeLoc = () =>
  Math.random() * ((canvas.height - (pipeGap + pipeWidth)) - pipeWidth) + pipeWidth;

/* ===== SETUP ===== */
function setup() {
  currentScore = 0;
  flight = jump;
  flyHeight = canvas.height / 2 - size[1] / 2;
  pipes = Array(3).fill().map((_, i) => [
    canvas.width + i * (pipeGap + pipeWidth),
    pipeLoc()
  ]);
}

/* ===== RENDER LOOP ===== */
function render() {
  index++;

  /* Background */
  ctx.drawImage(img, 0, 0, canvas.width, canvas.height,
    -((index * speed / 2) % canvas.width) + canvas.width, 0,
    canvas.width, canvas.height);
  ctx.drawImage(img, 0, 0, canvas.width, canvas.height,
    -(index * speed / 2) % canvas.width, 0,
    canvas.width, canvas.height);

  /* Pipes */
  if (gamePlaying) {
    pipes.forEach(pipe => {
      pipe[0] -= speed;
    pipe.x = Math.round(pipe.x);
      ctx.drawImage(img, 432, 588 - pipe[1], pipeWidth, pipe[1],
        pipe[0], 0, pipeWidth, pipe[1]);

      ctx.drawImage(img, 432 + pipeWidth, 108, pipeWidth,
        canvas.height - pipe[1] + pipeGap,
        pipe[0], pipe[1] + pipeGap,
        pipeWidth, canvas.height - pipe[1] + pipeGap);

      if (pipe[0] <= -pipeWidth) {
        currentScore++;
        bestScore = Math.max(bestScore, currentScore);
        pipes.push([pipes[pipes.length - 1][0] + pipeGap + pipeWidth, pipeLoc()]);
        pipes.shift();
      }

      if (
        pipe[0] <= cTenth + size[0] &&
        pipe[0] + pipeWidth >= cTenth &&
        (pipe[1] > flyHeight || pipe[1] + pipeGap < flyHeight + size[1])
      ) {
        gamePlaying = false;
        setup();
      }
    });
  }

  /* Bird */
  if (gamePlaying) {
    ctx.drawImage(img, 432, Math.floor((index % 9) / 3) * size[1],
      ...size, cTenth, flyHeight, ...size);
    flight += gravity;
    flyHeight += flight;
  } else {
    ctx.drawImage(img, 432, 0, ...size,
      canvas.width / 2 - size[0] / 2, flyHeight, ...size);
    flyHeight = canvas.height / 2 - size[1] / 2;

    ctx.fillStyle = "#000";
    ctx.font = "18px 'Press Start 2P'";
    ctx.fillText(`Best score : ${bestScore}`, 60, 260);
    ctx.fillText("Click to play", 90, 520);
  }

  document.getElementById("bestScore").textContent = `Best : ${bestScore}`;
  document.getElementById("currentScore").textContent = `Current : ${currentScore}`;

  requestAnimationFrame(render);
}

/* ===== CONTROLS ===== */
function jumpBird(e) {
  if (e) e.preventDefault();
  gamePlaying = true;
  flight = jump;
}

document.addEventListener("pointerdown", jumpBird, { passive: false });
document.addEventListener("keydown", e => {
  if (e.code === "Space") jumpBird();
});

/* ===== START ===== */
setup();
img.onload = render;
</script>
</body>
</html>